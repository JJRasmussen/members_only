<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./styles.css">
    <title>Home</title>
</head>
<body>
    <%- include('utils/header') %>
    <!-- If a user is logged in-->
    <% if (user) {%>
        <h1>WELCOME <%= user.username %></h1>
        <a href="/member-status">Edit membership status</a>
        <% if (!user.is_member){ %>
            <h2>To join the discussion a membership is required.</h2>
        <% } else { %>
            <form action="/new-message" method="POST">
                <label for="title">Title</label>
                <input 
                    type="text" 
                    name="messageTitle"
                    placeholder="username" 
                    id="messageTitle"
                    maxlength="50"
                    required
                    >
                <label for="messageContent">Content</label>
                <textarea 
                    name="messageContent" 
                    id="messageContent"
                    maxlength="255"
                    required
                ></textarea>
                <button type="submit">Post message</button>
            </form>
        <% } %>
        <%if(messages != undefined) {for (let i = messages.length -1; i >= 0; i--){ %>
            <div class="message">
                <ul class="messageTitle"><%= messages[i].title %></ul>
                <p class="textContent"><%= messages[i].text_content %></p>
            </div>
        <% }} %>
    <% } else { %>
    <!--If no user is logged in -->
        <h1>Please log in to view the message board</h1>
        <% if(userCreated) { %>
            <h2>User created successfully</h2>
        <% } %>
            <form action="/log-in" method="POST">
                <label for="username">Username</label>
                <input type="text" name="username" placeholder="username" id="username">
                <label for="password">Password</label>
                <input type="password" name="password" id="password">
                <button type="submit">Log In</button>
            </form>
        <% if (invalidLogin == true){%>
            <p> Invalid username or password </p>
        <% } %>
            <h2>If you are new to the site, please sign up here to join the discussion</h2>
            <a href="/sign-up">Sign Up</a>
        <%if(messages != undefined) {for (let i = messages.length -1; i >= 0; i--){ %>
            <!-- blurry teaser posts-->
            <div aria-hidden="true">
                <div class="message blurry">
                    <ul class="messageTitle">Adipisci culpa necessitatibus</ul>
                    <p class="textContent">Cupiditate nisi in, harum sed architecto quod repudiandae dignissimos, corrupti cum. Fugit quia dolores ducimus laudantium aliquid eligendi nemo enim?</p>
                </div>
                <div class="message blurry">
                    <ul class="messageTitle">Autem a quo iste?</ul>
                    <p class="textContent">Quae eaque odit blanditiis! Laboriosam quia saepe dolore ipsam molestias illo, numquam delectus dolor beatae rerum consectetur natus mollitia ullam hic animi repellat consequuntur eveniet impedit amet, tenetur enim? Aperiam.</p>
                </div> 
            </div>
        <% }} %>
    <% } %>
    <%- include('utils/footer') %>
</body>
</html>